var P=Object.defineProperty;var x=(s,t,r)=>t in s?P(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r;var c=(s,t,r)=>(x(s,typeof t!="symbol"?t+"":t,r),r);import{as as E,at as b,au as f,av as d,aw as A,i as C,ax as y}from"../.pnpm/.pnpm.b2939809.js";function w(...s){const t=E(...s),[r,e]=t.split("?");if(e){const u=e.split("&");return`${r}?${u.sort().join("&")}`}return t}function g(s,t={}){const{threshold:r=1e3,cache:e=new b({max:2})}=t,u=(o,a)=>{const n=(async()=>{try{const i=await s(a);return e.set(o,{timestamp:Date.now(),value:Promise.resolve(i)}),i}catch(i){throw e.delete(o),i}})();return e.set(o,{timestamp:Date.now(),value:n}),n};return o=>{const{url:a,method:n,params:i,paramsSerializer:D}=o,l=w(a,i,D),m=Date.now(),p=e.get(l)||{timestamp:m};if(n==="get"){if(m-p.timestamp<=r){const h=p.value;if(h)return console.info(`[axios-extensions] \u8282\u6D41\u9600\u9002\u914D --> url: ${l}`),h}return u(l,o)}return s(o)}}const q=(s,t={})=>{s.interceptors.response.use(r=>{var a,n;const{data:e,config:u,request:o}=r;return(n=(a=u==null?void 0:u.retry)==null?void 0:a.shouldRetry)!=null&&n.call(a,e)?(console.log("\u81EA\u5B9A\u4E49\u3010\u5F02\u5E38\u3011\u6761\u4EF6\u91CD\u8BD5"),u.retry.needRetry=!0,Promise.reject(new f.exports.AxiosError("\u81EA\u5B9A\u4E49\u6761\u4EF6\u91CD\u8BD5",e.code,u,o,r))):Promise.resolve(r)}),d(s,{...t,retryCondition:r=>{var e,u;return console.log("\u7F51\u7EDC\u3001\u8BF7\u6C42\u6216\u8005\u81EA\u5B9A\u4E49\u6761\u4EF6\u91CD\u8BD5"),d.isNetworkOrIdempotentRequestError(r)||((u=(e=r.config)==null?void 0:e.retry)==null?void 0:u.needRetry)||!1}})};function L(s){return A.stringify(s,{addQueryPrefix:!0,sort:(t,r)=>t.localeCompare(r)})}const{message:v}=C(["message"]);v.info("axios.page");class B{constructor(){c(this,"baseURL");c(this,"timeout");c(this,"adapter");this.baseURL="/api",this.timeout=1500,this.adapter=g(y.defaults.adapter)}getConfigParams(){return{baseURL:this.baseURL,timeout:this.timeout,headers:{},validateStatus:function(t){return![500,404].includes(t)}}}interceptors(t,r){t.interceptors.request.use(e=>(e.headers.Authorization="Bearer token666",e.headers["Content-Type"]="application/json;charset=utf-8",e.method==="get"&&e.params&&(e.url=e.url+L(e.params),e.params={}),e),e=>Promise.reject(e)),t.interceptors.response.use(e=>{const u=e;return Promise.resolve(u)},e=>Promise.reject(e))}request(t){const r=y.create();return t=Object.assign(this.getConfigParams(),t),q(r,{retries:2,shouldResetTimeout:!0,retryDelay:e=>e*3e3,onRetry:(e,u,o)=>{console.log(e,u,o)}}),this.interceptors(r,t.url),r(t)}}const U=new B,R=U;function S(){return R.request({url:"/onlogin",method:"get",params:{name:"baibai",label:"\u767D\u767D"}})}function $(){return R.request({url:"/ontest",method:"POST",retry:{shouldRetry:s=>s.code===404}})}export{$ as a,S as o};
